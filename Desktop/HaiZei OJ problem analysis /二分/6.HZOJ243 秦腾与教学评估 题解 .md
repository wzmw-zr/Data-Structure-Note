# HZOJ243 秦腾与教学评估 题解

## 题目描述

 在秦腾进入北京大学学习的第一个学期，就不幸遇到了前所未有的教学评估。

 在教学评估期间，同学们被要求八点起床，十一点回宿舍睡觉，不 准旷课，上课不准迟到，上课不准睡觉……甚至连著名的北大三角地也在教学评估期间被以影响校容的理由被拆除。这些“变态”规定令习惯了自由自在随性生活学习的北大同学叫苦不迭。

 这一天又到了星期五，一大早就是秦腾最不喜欢的高等代数课。可是因为是教学评估时期，不能迟到，于是他在八点五分的 时候挣扎着爬出了宿舍，希望能赶快混进在八点钟已经上课了的教室。

 可是，刚一出宿舍楼门他就傻眼了: 从宿舍到教学楼的路上已经站满了教学评估团的成员。他们的目的就是抓住像他这样迟到的学生，扣除学校的分数。

 秦腾当然不能让评估团得逞。他经过观察发现，整个评估团分成了N个小组，每个小组的成员都分布在从宿舍楼到教学楼的路上的某一段，并且同一小组的成员间的距离是相等的。于是，我们可以用三个整数 S,E,DS,E,D 来描述评估团的小组: 既该小组的成员在从宿舍到教学楼的路上的:S,S+D,S+2D,…,S+KD(K∈Z,S+KD≤E,S+(K+1)D>E)S,S+D,S+2D,…,S+KD(K∈Z,S+KD≤E,S+(K+1)D>E) 位置。

 观察到了教学评估团的这一特点，又经过了认真的思考，秦腾想出了对策: 如果在路上的某一位置有奇数个教学评估团成员，他就可以运用调虎离山，声东击西，隔山打牛，暗度陈仓……等方法，以这一地点为突破口到达教学楼。

 但是由于 教学评估团的成员的十分狡猾，成员位置安排的设计极其精妙，导致在整条路上几乎没有这样的位置出现。即使由于安排不慎重出现了这样的位置，最多也仅有一个。

 现在秦腾观察出了所有小组的安排，但是由于整个教学评估团的人数太多，他实在看不出这样的位置是否存在。

 现在，你的任务是写一个程序，帮助他做出判断。

## 分析

这道题实际上还是一道二分答案的题目，很多题目二分只是框架，重点在二分对象与判定标准的确定。



## 代码

```c++
#include<iostream>
using namespace std;
#define MAX_N 200000
#define INF 0x3f3f3f3f

struct Data {
    int s, e, d, c;
} arr[MAX_N + 5];
int n;

int check(int pos) {
    int cnt = 0;
    for (int i = 0; i < n; i++) {
        if (arr[i].s > pos) continue;
        if (arr[i].e <= pos) {
            cnt += arr[i].c;
            continue;
        }
        cnt += (pos - arr[i].s) / arr[i].d + 1;
    }
    return cnt;
}

int bs(int l, int r) {
    if (l == r) return l;
    int mid = ((l ^ r) >> 1) + (l & r);
    if (check(mid) & 1) return bs(l, mid);
    return bs(mid + 1, r);
}

void solve() {
    int l = INF, r = -INF;
    cin >> n;
    for (int i = 0; i < n; i++) {
        cin >> arr[i].s >> arr[i].e >> arr[i].d;
        arr[i].c = (arr[i].e - arr[i].s) / arr[i].d + 1;
        if (i == 0) l = arr[i].s, r = arr[i].e;
        l = min(arr[i].s, l);
        r = max(arr[i].e, r);
    }
    int pos = bs(l, r);
    int cnt = check(pos) - check(pos - 1);
    if (cnt % 2) {
        cout << pos << " " <<  cnt << endl;
    } else {
        cout << "Poor QIN Teng:(" << endl;
    }
}

int main() {
    int tcase;
    cin >> tcase;
    while (tcase--) {
        solve();
    }
    return 0;
}
```

